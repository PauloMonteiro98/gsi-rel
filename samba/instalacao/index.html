<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Instalação - Relatório GSI</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Instala\u00e7\u00e3o";
        var mkdocs_page_input_path = "samba/instalacao.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Relatório GSI
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Samba</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Instalação</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#requisitos">Requisitos</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-1-atualizar-os-pacotes">Passo 1: Atualizar os pacotes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-2-instalar-o-samba-e-dependencias">Passo 2: Instalar o Samba e Dependências</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-3-configurar-o-kerberos">Passo 3: Configurar o Kerberos</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-4-provisionar-o-controlador-de-dominio">Passo 4: Provisionar o Controlador de Domínio</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#explicacao-das-opcoes">Explicação das opções:</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-5-configurar-dns">Passo 5: Configurar DNS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-6-iniciar-o-samba">Passo 6: Iniciar o Samba</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-7-testar-a-configuracao-do-samba">Passo 7: Testar a Configuração do Samba</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-8-verificar-o-dns">Passo 8: Verificar o DNS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-9-configurar-as-regras-de-firewall-opcional">Passo 9: Configurar as Regras de Firewall (Opcional)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#passo-10-conectar-um-cliente-ao-controlador-de-dominio">Passo 10: Conectar um Cliente ao Controlador de Domínio</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#conclusao">Conclusão</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dns</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../dns/registros-a/">Registros</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Ldap</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../ldap/dn-ifrn/">DN</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Relatório GSI</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Samba</li>
      <li class="breadcrumb-item active">Instalação</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="configurando-o-samba-como-controlador-de-dominio-no-alpine-linux">Configurando o Samba como Controlador de Domínio no Alpine Linux</h1>
<p>Este guia cobre a instalação e configuração do Samba para atuar como um controlador de domínio do Active Directory no Alpine Linux.</p>
<h2 id="requisitos">Requisitos</h2>
<ul>
<li>Alpine Linux instalado e atualizado.</li>
<li>Acesso root ou privilégios <code>sudo</code>.</li>
<li>Conectividade de rede adequada.</li>
</ul>
<h2 id="passo-1-atualizar-os-pacotes">Passo 1: Atualizar os pacotes</h2>
<p>Antes de iniciar, atualize os pacotes do sistema:</p>
<pre><code class="language-sh">apk update
apk upgrade
</code></pre>
<h2 id="passo-2-instalar-o-samba-e-dependencias">Passo 2: Instalar o Samba e Dependências</h2>
<p>Instale o Samba e as dependências necessárias para configurá-lo como controlador de domínio do AD:</p>
<pre><code class="language-sh">apk add samba samba-dc samba-winbind krb5 krb5-server krb5-libs krb5-client openldap-clients
</code></pre>
<h2 id="passo-3-configurar-o-kerberos">Passo 3: Configurar o Kerberos</h2>
<p>O Samba como controlador de domínio AD requer a configuração do Kerberos. Edite o arquivo <code>/etc/krb5.conf</code>:</p>
<pre><code class="language-ini">[libdefaults]
    default_realm = EXEMPLO.COM
    dns_lookup_realm = false
    dns_lookup_kdc = true

[realms]
    EXEMPLO.COM = {
        kdc = dc.exemplo.com
        admin_server = dc.exemplo.com
    }

[domain_realm]
    .exemplo.com = EXEMPLO.COM
    exemplo.com = EXEMPLO.COM
</code></pre>
<p>Substitua <code>EXEMPLO.COM</code> pelo nome do seu domínio.</p>
<h2 id="passo-4-provisionar-o-controlador-de-dominio">Passo 4: Provisionar o Controlador de Domínio</h2>
<p>Antes de iniciar o Samba como um controlador de domínio, você precisa provisioná-lo com o comando <code>samba-tool</code>. Isso configura o Samba como um Controlador de Domínio (DC) do AD. Execute o seguinte comando:</p>
<pre><code class="language-sh">samba-tool domain provision --use-rfc2307 --interactive
</code></pre>
<p>Durante o provisionamento, você será solicitado a fornecer várias informações:</p>
<ul>
<li><strong>Realm</strong>: O nome do domínio, como <code>EXEMPLO.COM</code>.</li>
<li><strong>Domain</strong>: O nome do domínio, como <code>EXEMPLO</code>.</li>
<li><strong>Administrator password</strong>: Defina a senha para o usuário <code>Administrator</code>.</li>
</ul>
<p>Se preferir executar o provisionamento sem interação, você pode fornecer todas as opções de uma vez:</p>
<pre><code class="language-sh">samba-tool domain provision \
  --realm=EXEMPLO.COM \
  --domain=EXEMPLO \
  --adminpass=SuaSenhaForte \
  --server-role=dc \
  --use-rfc2307
</code></pre>
<h3 id="explicacao-das-opcoes">Explicação das opções:</h3>
<ul>
<li><code>--realm</code>: O nome completo do domínio no formato <code>EXEMPLO.COM</code>.</li>
<li><code>--domain</code>: O nome curto do domínio.</li>
<li><code>--adminpass</code>: A senha para o administrador do domínio.</li>
<li><code>--server-role</code>: Define o Samba como controlador de domínio (<code>dc</code>).</li>
<li><code>--use-rfc2307</code>: Ativa o suporte para esquemas Unix em AD (RFC2307).</li>
</ul>
<h2 id="passo-5-configurar-dns">Passo 5: Configurar DNS</h2>
<p>O Samba pode atuar como servidor DNS. Para habilitar o DNS, edite o arquivo <code>/etc/samba/smb.conf</code>, que foi gerado automaticamente durante o provisionamento. O arquivo deve conter as seguintes configurações:</p>
<pre><code class="language-ini">[global]
    workgroup = EXEMPLO
    realm = EXEMPLO.COM
    netbios name = DC1
    server role = active directory domain controller
    dns forwarder = 8.8.8.8

[sysvol]
    path = /var/lib/samba/sysvol
    read only = no

[netlogon]
    path = /var/lib/samba/sysvol/exemplo.com/scripts
    read only = no
</code></pre>
<p>A opção <code>dns forwarder</code> define o encaminhador de DNS. No exemplo, estamos utilizando o DNS público do Google (<code>8.8.8.8</code>), mas você pode substituir por outro de sua escolha.</p>
<h2 id="passo-6-iniciar-o-samba">Passo 6: Iniciar o Samba</h2>
<p>Agora, inicie o Samba como controlador de domínio:</p>
<pre><code class="language-sh">rc-service samba start
</code></pre>
<p>Para garantir que o Samba e os serviços relacionados sejam iniciados automaticamente na inicialização do sistema:</p>
<pre><code class="language-sh">rc-update add samba
</code></pre>
<h2 id="passo-7-testar-a-configuracao-do-samba">Passo 7: Testar a Configuração do Samba</h2>
<p>Verifique se o Samba está funcionando corretamente:</p>
<pre><code class="language-sh">samba-tool dns query localhost exemplo.com @ ALL
</code></pre>
<p>Esse comando deve retornar todas as zonas DNS configuradas.</p>
<p>Também é uma boa prática verificar se os serviços <code>smbd</code>, <code>nmbd</code> e <code>winbind</code> estão rodando:</p>
<pre><code class="language-sh">rc-service samba status
</code></pre>
<h2 id="passo-8-verificar-o-dns">Passo 8: Verificar o DNS</h2>
<p>Verifique se o servidor DNS está funcionando corretamente. Você pode testar a resolução de nomes com o <code>nslookup</code>:</p>
<pre><code class="language-sh">nslookup dc1.exemplo.com
</code></pre>
<h2 id="passo-9-configurar-as-regras-de-firewall-opcional">Passo 9: Configurar as Regras de Firewall (Opcional)</h2>
<p>Se você estiver usando um firewall, certifique-se de que as portas usadas pelo Samba estão abertas. As principais portas são:</p>
<ul>
<li><strong>TCP/UDP 53</strong>: DNS</li>
<li><strong>TCP/UDP 88</strong>: Kerberos</li>
<li><strong>TCP/UDP 135</strong>: RPC</li>
<li><strong>TCP/UDP 139 e 445</strong>: SMB</li>
<li><strong>UDP 389</strong>: LDAP</li>
<li><strong>TCP/UDP 464</strong>: Kerberos password changes</li>
<li><strong>TCP 636</strong>: LDAP sobre SSL (LDAPS)</li>
</ul>
<h2 id="passo-10-conectar-um-cliente-ao-controlador-de-dominio">Passo 10: Conectar um Cliente ao Controlador de Domínio</h2>
<p>Agora que o Samba está configurado como controlador de domínio, você pode conectar um cliente Windows ao domínio. Siga estas etapas em um cliente Windows:</p>
<ol>
<li>Abra o "Painel de Controle".</li>
<li>Vá em "Sistema e Segurança" &gt; "Sistema".</li>
<li>Clique em "Alterar configurações" em "Nome do computador, domínio e configurações de grupo de trabalho".</li>
<li>Clique em "Alterar".</li>
<li>Selecione "Domínio" e insira o nome do domínio (por exemplo, <code>EXEMPLO</code>).</li>
<li>Insira as credenciais do administrador do Samba quando solicitado.</li>
</ol>
<h2 id="conclusao">Conclusão</h2>
<p>Você configurou o Samba no Alpine Linux como um controlador de domínio do Active Directory. A partir daqui, você pode gerenciar seu domínio, adicionar máquinas e configurar permissões conforme necessário.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../dns/registros-a/" class="btn btn-neutral float-right" title="Registros">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="../../dns/registros-a/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
